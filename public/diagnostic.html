<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic - Overlay Blocking</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .result {
            background: #000;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #00ff00;
            border-radius: 5px;
        }
        .error {
            color: #ff0000;
        }
        .warning {
            color: #ffaa00;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            margin: 10px 5px;
        }
        button:hover {
            background: #00cc00;
        }
    </style>
</head>
<body>
    <h1>üîç Diagnostic de l'Overlay Bloquant</h1>

    <button onclick="runDiagnostic()">Lancer le Diagnostic</button>
    <button onclick="findBlockingElements()">Trouver √âl√©ments Bloquants</button>
    <button onclick="removeBlockingElements()">Supprimer Overlays (TEST)</button>

    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'result ' + type;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function runDiagnostic() {
            document.getElementById('results').innerHTML = '';
            log('<h2>üöÄ D√©but du Diagnostic...</h2>');

            // 1. V√©rifier les overlays/modals cach√©s
            log('<h3>1Ô∏è‚É£ Recherche d\'overlays/modals...</h3>');
            const overlays = document.querySelectorAll('[class*="overlay"], [class*="modal"], [class*="backdrop"]');
            if (overlays.length > 0) {
                log(`‚ö†Ô∏è Trouv√© ${overlays.length} overlay(s)/modal(s):`, 'warning');
                overlays.forEach((el, i) => {
                    const isHidden = el.classList.contains('hidden') ||
                                   window.getComputedStyle(el).display === 'none' ||
                                   window.getComputedStyle(el).visibility === 'hidden';
                    log(`  ${i+1}. ${el.tagName} - Classes: ${el.className} - Cach√©: ${isHidden ? '‚úÖ' : '‚ùå PROBL√àME!'}`);
                });
            } else {
                log('‚úÖ Aucun overlay/modal trouv√©');
            }

            // 2. V√©rifier les √©l√©ments avec z-index √©lev√©
            log('<h3>2Ô∏è‚É£ Recherche d\'√©l√©ments avec z-index √©lev√©...</h3>');
            const highZIndex = Array.from(document.querySelectorAll('*')).filter(el => {
                const style = window.getComputedStyle(el);
                const zIndex = parseInt(style.zIndex) || 0;
                return zIndex > 40;
            });

            if (highZIndex.length > 0) {
                log(`‚ö†Ô∏è Trouv√© ${highZIndex.length} √©l√©ment(s) avec z-index > 40:`, 'warning');
                highZIndex.forEach((el, i) => {
                    const style = window.getComputedStyle(el);
                    log(`  ${i+1}. ${el.tagName}.${el.className} - z-index: ${style.zIndex}, position: ${style.position}, visible: ${style.visibility}, display: ${style.display}`);
                });
            } else {
                log('‚úÖ Aucun z-index √©lev√© probl√©matique');
            }

            // 3. V√©rifier les √©l√©ments fixed/absolute qui couvrent toute la page
            log('<h3>3Ô∏è‚É£ Recherche d\'√©l√©ments fixed/absolute couvrant la page...</h3>');
            const covering = Array.from(document.querySelectorAll('*')).filter(el => {
                const style = window.getComputedStyle(el);
                const position = style.position;
                if (position === 'fixed' || position === 'absolute') {
                    const rect = el.getBoundingClientRect();
                    return rect.width > window.innerWidth * 0.8 && rect.height > window.innerHeight * 0.8;
                }
                return false;
            });

            if (covering.length > 0) {
                log(`‚ö†Ô∏è Trouv√© ${covering.length} √©l√©ment(s) couvrant la page:`, 'warning');
                covering.forEach((el, i) => {
                    const style = window.getComputedStyle(el);
                    const rect = el.getBoundingClientRect();
                    log(`  ${i+1}. ${el.tagName}.${el.className} - ${rect.width}x${rect.height}px, z-index: ${style.zIndex}, bg: ${style.backgroundColor}`);
                });
            } else {
                log('‚úÖ Aucun √©l√©ment couvrant trouv√©');
            }

            // 4. V√©rifier pointer-events
            log('<h3>4Ô∏è‚É£ V√©rification pointer-events sur body...</h3>');
            const bodyStyle = window.getComputedStyle(document.body);
            if (bodyStyle.pointerEvents === 'none') {
                log('‚ùå PROBL√àME: pointer-events: none sur body!', 'error');
            } else {
                log(`‚úÖ pointer-events: ${bodyStyle.pointerEvents}`);
            }

            log('<h2>‚úÖ Diagnostic termin√©!</h2>');
        }

        function findBlockingElements() {
            document.getElementById('results').innerHTML = '';
            log('<h2>üéØ Recherche des √©l√©ments bloquants au centre de la page...</h2>');

            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;

            const elementAtCenter = document.elementFromPoint(centerX, centerY);

            if (elementAtCenter) {
                log(`<h3>√âl√©ment au centre de la page (${centerX}, ${centerY}):</h3>`);
                log(`Tag: <strong>${elementAtCenter.tagName}</strong>`);
                log(`Classes: <strong>${elementAtCenter.className}</strong>`);
                log(`ID: <strong>${elementAtCenter.id || 'aucun'}</strong>`);

                const style = window.getComputedStyle(elementAtCenter);
                log(`<strong>Styles:</strong><br>
                    - position: ${style.position}<br>
                    - z-index: ${style.zIndex}<br>
                    - background: ${style.backgroundColor}<br>
                    - opacity: ${style.opacity}<br>
                    - pointer-events: ${style.pointerEvents}<br>
                    - display: ${style.display}<br>
                    - visibility: ${style.visibility}
                `);

                // Mettre en √©vidence l'√©l√©ment
                elementAtCenter.style.outline = '5px solid red';
                elementAtCenter.style.outlineOffset = '-5px';

                log(`<span class="warning">‚ö†Ô∏è L'√©l√©ment a √©t√© mis en √©vidence avec un contour rouge!</span>`);
            } else {
                log('‚ùå Aucun √©l√©ment trouv√© au centre', 'error');
            }
        }

        function removeBlockingElements() {
            document.getElementById('results').innerHTML = '';
            log('<h2>üßπ Suppression des overlays bloquants (TEST)...</h2>');

            let removed = 0;

            // Supprimer les √©l√©ments avec classe modal/overlay non cach√©s
            document.querySelectorAll('[class*="modal"], [class*="overlay"], [class*="backdrop"]').forEach(el => {
                const isHidden = el.classList.contains('hidden') ||
                               window.getComputedStyle(el).display === 'none';
                if (!isHidden) {
                    log(`Suppression: ${el.tagName}.${el.className}`, 'warning');
                    el.remove();
                    removed++;
                }
            });

            // Supprimer les √©l√©ments fixed avec z-index tr√®s √©lev√© et fond sombre
            Array.from(document.querySelectorAll('*')).forEach(el => {
                const style = window.getComputedStyle(el);
                const zIndex = parseInt(style.zIndex) || 0;
                if (style.position === 'fixed' && zIndex > 100 &&
                    (style.backgroundColor.includes('rgba(0, 0, 0') || style.backgroundColor === 'transparent')) {
                    const rect = el.getBoundingClientRect();
                    if (rect.width > window.innerWidth * 0.8) {
                        log(`Suppression overlay suspect: ${el.tagName}.${el.className}`, 'warning');
                        el.remove();
                        removed++;
                    }
                }
            });

            if (removed === 0) {
                log('‚ÑπÔ∏è Aucun overlay bloquant trouv√© √† supprimer');
            } else {
                log(`‚úÖ ${removed} √©l√©ment(s) supprim√©(s)! Essayez de cliquer maintenant.`);
            }
        }

        // Auto-run au chargement
        window.addEventListener('load', function() {
            log('<p style="color: #ffaa00;">Page charg√©e. Cliquez sur "Lancer le Diagnostic" pour commencer.</p>');
        });
    </script>
</body>
</html>
